// Generated by CoffeeScript 1.12.2
(function() {
  this.CountDownTimer = {
    states: {
      started: 1,
      stopped: 2,
      idle: 3
    },
    stopAnimator: function() {
      return clearInterval(this.animator);
    },
    start: function() {
      $('#timer .toggle-timer').text('Stop');
      this.currentState = this.states.started;
      this.endTime = Date.now() + 60000;
      return this.animator = setInterval((function(_this) {
        return function() {
          return _this.propagateTimer();
        };
      })(this), 30);
    },
    reset: function() {
      $('#timer .toggle-timer').text('Start');
      this.currentState = this.states.idle;
      this.stopAnimator(true);
      this.setTime(0);
      return this.stopAudio(this.timerAudio);
    },
    stop: function() {
      $('#timer .toggle-timer').text('Reset');
      this.currentState = this.states.stopped;
      this.stopAnimator();
      return this.stopAudio(this.timerAudio);
    },
    toggle: function() {
      switch (this.currentState) {
        case this.states.idle:
          return this.start();
        case this.states.stopped:
          return this.reset();
        case this.states.started:
          return this.stop();
      }
    },
    propagateTimer: function() {
      var currentTime;
      currentTime = Date.now();
      if (currentTime > this.endTime) {
        this.reset();
        return this.startAudio(this.bellAudio);
      } else {
        return this.setTime(this.endTime - currentTime);
      }
    },
    setTime: function(time) {
      var centiSeconds, seconds;
      time = Math.floor(time / 10);
      centiSeconds = time % 100;
      time = Math.floor(time / 100);
      seconds = time % 60;
      return $('#timer .time').text((this.padZero(seconds)) + ":" + (this.padZero(centiSeconds)));
    },
    padZero: function(num) {
      num = num + '';
      if (num.length === 1) {
        num = "" + 0 + num;
      }
      return num;
    },
    startAudio: function(audio) {
      audio.currentTime = 0;
      return audio.play();
    },
    stopAudio: function(audio) {
      if (audio) {
        return audio.pause();
      }
    },
    init: function() {
      this.reset();
      this.timerAudio = new Audio('public/audio/adrenaline.mp3');
      this.timerAudio.volume = 0.3;
      this.bellAudio = new Audio('public/audio/ting.mp3');
      return $('#timer .toggle-timer').click((function(_this) {
        return function(ev) {
          ev.preventDefault();
          _this.startAudio(_this.timerAudio);
          return _this.toggle();
        };
      })(this));
    }
  };

  $(function() {
    return CountDownTimer.init();
  });

}).call(this);
